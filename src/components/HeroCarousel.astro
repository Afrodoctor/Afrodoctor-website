---
/*
  HeroCarousel.astro
  Updated per CEO & your instructions:
   - ordering of slides: 2 VC images (unique captions), 2 young-women training (shared caption),
     2 PWD training (shared caption), 1 HMS slide, 1 Mobile App slide (IMG2.jpg).
   - removed indicators/dots
   - preserved prev/next controls, keyboard + swipe, reduced-motion respect, and text animations
*/
const slides = [
  // Vice Chancellor images (2) - each with unique caption
  {
    src: '/images/immersed/IMG1.jpg',
    alt: 'Meeting with Kenyatta University Vice Chancellor',
    title: 'Kenyatta University Vice Chancellor visits Afrodoctor',
    subtitle: 'The Vice Chancellor of KU, Prof. Paul Wainaina visited Afrodoctor to provide leadership support on the transformational fund activities.'
  },
  {
    src: '/images/immersed/IMG5.jpg',
    alt: 'Team members group photo with the Kenyatta University Vice Chancellor',
    title: 'Kenyatta University leadership engagement at Afrodoctor',
    subtitle: 'Kenyatta University leadership met Afrodoctor to discuss partnership support and collaboration on the transformational fund.'
  },

  // Training of digital health champions - Young women (2) - shared caption
  {
    src: '/images/immersed/DSC_0113.JPG',
    alt: 'Students with laptops during digital skills training',
    title: 'Building capacity of marginalized communities in digital health skills',
    subtitle: 'We trained young women and persons with disabilities in digital health and literacy who cascaded the skills to their peers in their communities to create impact.'
  },
  {
    src: '/images/immersed/DSC_0114.JPG',
    alt: 'Training session with young women participants',
    title: 'Building capacity of marginalized communities in digital health skills',
    subtitle: 'We trained young women and persons with disabilities in digital health and literacy who cascaded the skills to their peers in their communities to create impact.'
  },

  // Training of digital health champions - PWDs (2) - shared caption (same as above)
  {
    src: '/images/pwds/pwd1.jpg',
    alt: 'Persons with disabilities participating in training',
    title: 'Building capacity of marginalized communities in digital health skills',
    subtitle: 'We trained young women and persons with disabilities in digital health and literacy who cascaded the skills to their peers in their communities to create impact.'
  },
  {
    src: '/images/pwds/pwd5.jpg',
    alt: 'Instructor demonstrating digital health tools to PWD participants',
    title: 'Building capacity of marginalized communities in digital health skills',
    subtitle: 'We trained young women and persons with disabilities in digital health and literacy who cascaded the skills to their peers in their communities to create impact.'
  },

  // Afrodoctor - HMS (single animated image)
  {
    src: '/images/immersed/IMG3.jpg',
    alt: 'Afrodoctor HMS ‚Äî systems and leadership',
    title: 'Reach more patients with Afrodoctor ‚Äì HMS',
    subtitle: 'Choose a comprehensive and user-friendly health facility management system to streamline patient appointments, online consultations, facility workflows and records management.'
  },

  // Afrodoctor mobile app (use IMG2.jpg as requested)
  {
    src: '/images/immersed/IMG2.jpg',
    alt: 'CEO giving speech',
    title: 'Avoid the lines and uncertainty: Get yourself a doctor‚Äôs appointment now',
    subtitle: 'Download the Afrodoctor mobile app and get yourself a doctor‚Äôs appointment, consult online, and receive your medical reports online.'
  }
];

const slideCount = slides.length;
---
<style>
  /* Hero text animations: fade + translate up */
  @keyframes hero-fade-up {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .hero-animate {
    animation: hero-fade-up 420ms cubic-bezier(.2,.9,.2,1);
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .hero-animate { animation: none !important; transform: none !important; opacity: 1 !important; }
  }

  /* Slight visual for prev/next buttons */
  .hero-controls .btn { transition: transform .15s ease; }
  .hero-controls .btn:hover { transform: scale(1.06); }
</style>

<div class="relative w-full mt-20" data-hero>
  <div class="relative h-[85vh] md:h-[90vh] lg:h-[95vh] overflow-hidden">
    <div id="slidesWrapper" class="absolute inset-0 flex transition-transform duration-700 ease-in-out will-change-transform">
      {slides.map((s, i) => (
        <div
          class="min-w-full h-full flex-shrink-0 relative"
          role="group"
          aria-roledescription="slide"
          aria-label={`Slide ${i + 1} of ${slideCount}`}
          data-index={i}
        >
          <img src={s.src} alt={s.alt} data-title={s.title} data-subtitle={s.subtitle} class="w-full h-full object-cover" loading="lazy" decoding="async" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
        </div>
      ))}
    </div>

    <div class="absolute top-6 left-6 z-30">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-white/90 dark:bg-gray-800/70 text-sm font-semibold shadow-sm">
        <span class="text-blue-700 dark:text-blue-300">üåç</span>
        <span class="text-gray-800 dark:text-gray-100">Transforming African Healthcare</span>
      </div>
    </div>

    <div class="absolute bottom-24 right-6 md:right-12 z-30 max-w-2xl text-right px-4 pointer-events-none">
      <h1 id="heroTitle" class="text-3xl md:text-5xl lg:text-6xl font-extrabold leading-tight text-white drop-shadow-lg" aria-live="polite">{slides[0].title}</h1>
      <p id="heroSubtitle" class="mt-2 text-lg md:text-xl text-white/90 ml-auto drop-shadow-md">{slides[0].subtitle}</p>
    </div>

    <!-- Prev / Next controls (kept) -->
    <div class="absolute inset-y-0 left-0 z-40 flex items-center pl-4 hero-controls">
      <button id="heroPrev" aria-label="Previous slide" class="btn w-12 h-12 rounded-full bg-white/10 text-white flex items-center justify-center focus:outline-none backdrop-blur-sm">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
      </button>
    </div>

    <div class="absolute inset-y-0 right-0 z-40 flex items-center pr-4 hero-controls">
      <button id="heroNext" aria-label="Next slide" class="btn w-12 h-12 rounded-full bg-white/10 text-white flex items-center justify-center focus:outline-none backdrop-blur-sm">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/></svg>
      </button>
    </div>

    <!-- NOTE: indicators removed as requested -->
  </div>

  <script is:inline>
    (() => {
      const wrapper = document.getElementById('slidesWrapper');
      const prevBtn = document.getElementById('heroPrev');
      const nextBtn = document.getElementById('heroNext');
      const heroTitle = document.getElementById('heroTitle');
      const heroSubtitle = document.getElementById('heroSubtitle');

      const slides = Array.from(document.querySelectorAll('#slidesWrapper > [data-index]'));
      let index = 0;
      let interval = null;
      const count = slides.length;

      const slideDataset = Array.from({ length: count }).map((_, i) => {
        // read the data attributes set on the images (keeps content single-source)
        const img = slides[i].querySelector('img');
        return {
          title: img?.dataset?.title || '',
          subtitle: img?.dataset?.subtitle || ''
        };
      });

      const animateText = (el) => {
        if (!el) return;
        el.classList.remove('hero-animate');
        void el.offsetWidth;
        el.classList.add('hero-animate');
      };

      const setSlideData = (i) => {
        const meta = slideDataset[i] || slideDataset[0];
        heroTitle.textContent = meta.title;
        heroSubtitle.textContent = meta.subtitle;

        if (!(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches)) {
          animateText(heroTitle);
          animateText(heroSubtitle);
        }
      };

      const moveTo = (i) => {
        index = (i + count) % count;
        wrapper.style.transform = `translateX(-${index * 100}%)`;
        setSlideData(index);
      };

      const next = () => moveTo(index + 1);
      const prev = () => moveTo(index - 1);

      nextBtn?.addEventListener('click', (e) => { e.stopPropagation(); next(); resetAuto(); });
      prevBtn?.addEventListener('click', (e) => { e.stopPropagation(); prev(); resetAuto(); });

      const startAuto = () => {
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        interval = setInterval(next, 6000);
      };
      const resetAuto = () => { clearInterval(interval); startAuto(); };

      // initialize
      moveTo(0);
      startAuto();

      // keyboard support
      window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') { next(); resetAuto(); }
        if (e.key === 'ArrowLeft') { prev(); resetAuto(); }
        if (e.key === 'Home') { moveTo(0); resetAuto(); }
        if (e.key === 'End') { moveTo(count - 1); resetAuto(); }
      });

      // swipe support
      let startX = null;
      wrapper.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive: true });
      wrapper.addEventListener('touchend', (e) => {
        if (startX === null) return;
        const endX = e.changedTouches[0].clientX;
        const diff = startX - endX;
        if (diff > 40) next();
        if (diff < -40) prev();
        startX = null;
        resetAuto();
      });
    })();
  </script>
</div>
