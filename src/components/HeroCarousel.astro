---
/*
  HeroCarousel.astro
*/
const slides = [
    {
    src: '/images/immersed/IMG5.jpg',
    alt: 'Afrodoctor HMS demo in action',
    title: 'Advancing Digital Health Systems',
    subtitle: 'Connecting patients and health workers across Africa with secure appointments and digital records.',
  },
  {
    src: '/images/immersed/DSC_0113.JPG',
    alt: 'Students with laptops during digital skills training',
    title: 'Digital Skills Training in Action',
    subtitle: 'Hands-on training sessions where marginalized communities learn digital health tools and applications.',
  },
  {
    src: '/images/immersed/DSC_0140.JPG',
    alt: 'Community outreach and health education session',
    title: 'Community Health Outreach',
    subtitle: 'Engaging directly with communities to provide digital health education and build local capacity.',
  },
    {
    src: '/images/immersed/IMG2.jpg',
    alt: 'Immersed training: digital skills session‚Äîgroup shot',
    title: 'Building Local Capacity',
    subtitle: 'Training communities in digital and sexual & reproductive health to create community health champions.',
  },
];
const slideCount = slides.length;
---
<style>
  /* Hero text animations: fade + translate up */
  @keyframes hero-fade-up {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .hero-animate {
    animation: hero-fade-up 420ms cubic-bezier(.2,.9,.2,1);
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .hero-animate { animation: none !important; transform: none !important; opacity: 1 !important; }
  }

  .indicator-active { transform: scaleX(1.8); transition: transform .28s cubic-bezier(.2,.9,.2,1); }
</style>

<div class="relative w-full mt-20" data-hero>
  <div class="relative h-[85vh] md:h-[90vh] lg:h-[95vh] overflow-hidden">
    <div id="slidesWrapper" class="absolute inset-0 flex transition-transform duration-700 ease-in-out will-change-transform">
      {slides.map((s, i) => (
        <div
          class="min-w-full h-full flex-shrink-0 relative"
          role="group"
          aria-roledescription="slide"
          aria-label={`Slide ${i + 1} of ${slideCount}`}
          data-index={i}
        >
          <img src={s.src} alt={s.alt} data-title={s.title} data-subtitle={s.subtitle} class="w-full h-full object-cover" loading="lazy" decoding="async" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
        </div>
      ))}
    </div>

    <div class="absolute top-6 left-6 z-30">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-white/90 dark:bg-gray-800/70 text-sm font-semibold shadow-sm">
        <span class="text-blue-700 dark:text-blue-300">üåç</span>
        <span class="text-gray-800 dark:text-gray-100">Transforming African Healthcare</span>
      </div>
    </div>

    <div class="absolute bottom-20 right-6 md:right-12 z-30 max-w-2xl text-right px-4 pointer-events-none">
      <h1 id="heroTitle" class="text-3xl md:text-5xl lg:text-6xl font-extrabold leading-tight text-white drop-shadow-lg" aria-live="polite">{slides[0].title}</h1>
      <p id="heroSubtitle" class="mt-2 text-lg md:text-xl text-white/90 ml-auto drop-shadow-md">{slides[0].subtitle}</p>
    </div>

    <button id="heroPrev" aria-label="Previous slide" class="absolute left-4 top-1/2 -translate-y-1/2 z-40 w-12 h-12 rounded-full bg-white/10 text-white flex items-center justify-center hover:scale-105 transition backdrop-blur-sm">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
    </button>
    <button id="heroNext" aria-label="Next slide" class="absolute right-4 top-1/2 -translate-y-1/2 z-40 w-12 h-12 rounded-full bg-white/10 text-white flex items-center justify-center hover:scale-105 transition backdrop-blur-sm">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/></svg>
    </button>

    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-40 flex items-center gap-2">
      {slides.map((_, i) => (
        <button
          data-indicator={i}
          aria-label={`Go to slide ${i + 1}`}
          class="w-3 h-3 rounded-full bg-white/60 hover:scale-110 transition-all"
        />
      ))}
    </div>
  </div>

  <script is:inline>
    (() => {
      const slides = Array.from(document.querySelectorAll('#slidesWrapper > [data-index]'));
      const wrapper = document.getElementById('slidesWrapper');
      const prevBtn = document.getElementById('heroPrev');
      const nextBtn = document.getElementById('heroNext');
      const indicators = Array.from(document.querySelectorAll('[data-indicator]'));
      const heroTitle = document.getElementById('heroTitle');
      const heroSubtitle = document.getElementById('heroSubtitle');
      // removed button selectors

      let index = 0;
      let interval = null;
      const count = slides.length;

      // simplified dataset (no CTAs)
      const slideDataset = [
         { title: 'Advancing Digital Health Systems', subtitle: 'Connecting patients and health workers across Africa with secure appointments and digital records.' },
        { title: 'Digital Skills Training in Action', subtitle: 'Hands-on training sessions where marginalized communities learn digital health tools and applications.' },
        { title: 'Community Health Outreach', subtitle: 'Engaging directly with communities to provide digital health education and build local capacity.' },
        { title: 'Building Local Capacity', subtitle: 'Training communities in digital and sexual & reproductive health to create community health champions.' },
      ];

      const animateText = (el) => {
        if (!el) return;
        el.classList.remove('hero-animate');
        void el.offsetWidth;
        el.classList.add('hero-animate');
      };

      const setSlideData = (i) => {
        const meta = slideDataset[i] || slideDataset[0];
        
        // update text only
        heroTitle.textContent = meta.title;
        heroSubtitle.textContent = meta.subtitle;

        // animate text
        if (!(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches)) {
          animateText(heroTitle);
          animateText(heroSubtitle);
        }

        indicators.forEach((btn, idx) => {
          btn.style.opacity = idx === i ? '1' : '0.6';
          if (idx === i) btn.classList.add('indicator-active'); else btn.classList.remove('indicator-active');
        });
      };

      const moveTo = (i) => {
        index = (i + count) % count;
        wrapper.style.transform = `translateX(-${index * 100}%)`;
        setSlideData(index);
      };

      const next = () => moveTo(index + 1);
      const prev = () => moveTo(index - 1);

      nextBtn?.addEventListener('click', (e) => { e.stopPropagation(); next(); resetAuto(); });
      prevBtn?.addEventListener('click', (e) => { e.stopPropagation(); prev(); resetAuto(); });
      indicators.forEach((btn, i) => btn.addEventListener('click', (e) => { e.stopPropagation(); moveTo(i); resetAuto(); }));

      const startAuto = () => {
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        interval = setInterval(next, 6000);
      };
      const resetAuto = () => { clearInterval(interval); startAuto(); };

      // initialize
      moveTo(0);
      startAuto();

      // keyboard support
      window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') { next(); resetAuto(); }
        if (e.key === 'ArrowLeft') { prev(); resetAuto(); }
        if (e.key === 'Home') { moveTo(0); resetAuto(); }
        if (e.key === 'End') { moveTo(count - 1); resetAuto(); }
      });

      // swipe support
      let startX = null;
      wrapper.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive: true });
      wrapper.addEventListener('touchend', (e) => {
        if (startX === null) return;
        const endX = e.changedTouches[0].clientX;
        const diff = startX - endX;
        if (diff > 40) next();
        if (diff < -40) prev();
        startX = null;
        resetAuto();
      });
    })();
  </script>
</div>